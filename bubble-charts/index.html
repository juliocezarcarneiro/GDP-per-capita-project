<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>GDP and Health Spending Analysis</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background-color: #f8f9fa;
    }
    .card {
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }
    .card-header {
      background-color: #0d6efd;
      color: white;
    }
    #bubble {
      height: 600px;
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="row">
      <div class="col-md-12 p-5 text-center bg-light">
        <h1>Global Economic Indicators</h1>
        <p>Explore the relationship between GDP per capita and health spending across countries</p>
      </div>
    </div>
    
    <div class="row mt-4">
      <div class="col-md-12">
        <div class="card">
          <div class="card-header">
            <h4>GDP vs Health Spending per Capita</h4>
          </div>
          <div class="card-body">
            <div id="bubble"></div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="row mt-4">
      <div class="col-md-12 text-center">
        <p class="text-muted">Data source: World Bank Indicators</p>
      </div>
    </div>
  </div>

  <!-- JavaScript Libraries -->
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  
  <script>
    // Initialize the page
    function init() {
      buildBubbleChart();
    }

    // Build the bubble chart
    function buildBubbleChart() {
   
      // Load the data
      d3.json("https://juliocezarcarneiro.github.io/GDP-per-capita-project/bubble-charts/countries-data.json")
        .then((data) => {
          // Filter out entries with missing data
          data = data.filter(d => d.GDP_per_capita && d.Health_spending_per_capita);

        let countries = data.map(d => d["Country Name"]);
        let gdp = data.map(d => d.GDP_per_capita);
        let health = data.map(d => d.Health_spending_per_capita);


          // Bubble chart data
          let bubbleData = [{
            x: gdp,
            y: health,
            text: countries.map((c, i) => 
              `<b>${c}</b><br>` +
              `GDP per capita: $${gdp[i].toLocaleString()}<br>` +
              `Health spending: $${health[i].toLocaleString()}`
            ),
            mode: 'markers',
            marker: {
              size: health.map(h => Math.sqrt(h) * 3),
              sizemode: 'area',
              sizeref: 0.1,
              color: gdp,
              colorscale: 'Viridis',
              opacity: 0.7,
              line: {
                width: 1,
                color: '#333'
              },
              colorbar: {
                title: 'GDP per Capita',
                tickprefix: '$'
              }
            },
            type: 'scatter',
            hoverinfo: 'text',
            hoverlabel: {
              bgcolor: 'white',
              font: {
                family: 'Arial',
                size: 12,
                color: 'black'
              }
            }
          }];

          // Layout configuration
          const bubbleLayout = {
            title: {
              text: 'GDP per Capita vs Health Spending per Capita',
              font: {
                size: 18,
                family: 'Arial'
              }
            },
            xaxis: {
              title: {
                text: 'GDP per Capita (USD) - Log Scale',
                font: {
                  size: 14
                }
              },
              type: 'log',
              gridcolor: '#eee',
              zeroline: false,
              tickprefix: '$',
              tickformat: ',.0f'
            },
            yaxis: {
              title: {
                text: 'Health Spending per Capita (USD) - Log Scale',
                font: {
                  size: 14
                }
              },
              type: 'log',
              gridcolor: '#eee',
              zeroline: false,
              tickprefix: '$',
              tickformat: ',.0f'
            },
            hovermode: 'closest',
            margin: { t: 80, l: 80, r: 80, b: 80 },
            height: 550,
            plot_bgcolor: 'rgba(240,240,240,0.8)',
            paper_bgcolor: 'rgba(240,240,240,0.3)'
          };

          // Render the chart
          Plotly.newPlot("bubble", bubbleData, bubbleLayout);
        })
        .catch(error => {
          console.error("Error loading the data: ", error);
          d3.select("#bubble").html(`
            <div class="alert alert-danger mt-4">
              <h4>Error Loading Data</h4>
              <p>${error.message}</p>
              <p>Please try refreshing the page or check your internet connection.</p>
            </div>
          `);
        });
    }

    // Call init when the page loads
    window.onload = init;
  </script>
  
  <!-- Bootstrap JS Bundle with Popper -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>